CC = g++
OBJCOPY = riscv64-unknown-linux-gnu-objcopy

SDK_LIB_DIR =$(KEYSTONE_SDK_DIR)/lib
SDK_HOST_LIB = $(SDK_LIB_DIR)/libkeystone-host.a
SDK_EDGE_LIB = $(SDK_LIB_DIR)/libkeystone-edge.a
SDK_VERIFIER_LIB = $(SDK_LIB_DIR)/libkeystone-verifier.a

SDK_INCLUDE_HOST_DIR = $(SDK_LIB_DIR)/host/include
SDK_INCLUDE_EDGE_DIR = $(SDK_LIB_DIR)/edge/include
SDK_INCLUDE_VERIFIER_DIR = $(SDK_LIB_DIR)/verifier


SRC_DIR = $(SDK_LIB_DIR)/host/src
SRC = Keystone.cpp ELFFile.cpp elf.cpp elf32.cpp elf64.cpp sha3.cpp Memory.cpp KeystoneDevice.cpp
SRCS = $(addprefix $(SRC_DIR)/, $(SRC))

SCRIPTS_DIR = scripts
TEST_BIN_DIR = test_binary

CCFLAGS = -I$(SDK_INCLUDE_HOST_DIR) -I$(SDK_INCLUDE_EDGE_DIR) -I$(SDK_INCLUDE_VERIFIER_DIR) -std=c++11
LDFLAGS = -L$(SDK_LIB_DIR)
GFLAGS = -lgtest
TARGET = test_runner

all:
	$(SCRIPTS_DIR)/setup_binary.sh
	$(CC) $(CCFLAGS) $(LDFLAGS) keystone_test.cpp $(SRCS) -o $(TARGET) $(GFLAGS)

test:
	./$(TARGET)

clean:
	rm -rf $(TEST_BIN_DIR)
	rm $(TARGET)


